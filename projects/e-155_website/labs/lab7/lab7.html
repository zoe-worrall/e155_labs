<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zoe Worrall - zworrall@g.hmc.edu">
<meta name="dcterms.date" content="2024-11-01">

<title>Lab 7 Writeup – Zoe Worrall's Website</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../images/bg_test.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../../../site_libs/quarto-contrib/videojs/video.min.js"></script>
<link href="../../../../site_libs/quarto-contrib/videojs/video-js.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-image',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: ["listing-image"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="Zoe Worrall’s Website - Lab 7 Writeup">
<meta property="og:description" content="">
<meta property="og:image" content="https://zoe-worrall.github.io/e155_labs/projects/e-155_website/labs/lab7/images/ZoeWorrall_Photo.png">
<meta property="og:site_name" content="Zoe Worrall's Website">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../../images/zoe_logo.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../projects/e-155_website/blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-e155-labs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">E155 Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-e155-labs">    
        <li>
    <a class="dropdown-item" href="../../../../projects/e-155_website/labs/lab1/lab1.html">
 <span class="dropdown-text">Lab 1 Writeup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/e-155_website/labs/lab2/lab2.html">
 <span class="dropdown-text">Lab 2 Writeup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/e-155_website/labs/lab3/lab3.html">
 <span class="dropdown-text">Lab 3 Writeup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/e-155_website/labs/lab4/lab4.html">
 <span class="dropdown-text">Lab 4 Writeup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/e-155_website/labs/lab5/lab5.html">
 <span class="dropdown-text">Lab 5 Writeup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/e-155_website/labs/lab6/lab6.html">
 <span class="dropdown-text">Lab 6 Writeup</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/e-155_website/labs/lab7/lab7.html">
 <span class="dropdown-text">Lab 7 Writeup</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../../../../projects/e-155_website">
 <span class="dropdown-text">E155 Project</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/E80_sub.html">
 <span class="dropdown-text">Engineering Systems E80</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/mcf_lci.html">
 <span class="dropdown-text">Multicore Fiber Bundle Low Coherence Interferometry Research</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/open_ivis.html">
 <span class="dropdown-text">openIVIS</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../projects/radio_frequency">
 <span class="dropdown-text">RF Circuitry Projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../art/index.html"> 
<span class="menu-text">Zoe Worrall’s Artworks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../contacts/index.html"> 
<span class="menu-text">Contact Me</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lab-7-aes-128" id="toc-lab-7-aes-128" class="nav-link active" data-scroll-target="#lab-7-aes-128">Lab 7: AES-128</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#aes-128s-structure" id="toc-aes-128s-structure" class="nav-link" data-scroll-target="#aes-128s-structure">AES-128’s Structure</a></li>
  <li><a href="#final-setup" id="toc-final-setup" class="nav-link" data-scroll-target="#final-setup">Final Setup</a></li>
  <li><a href="#test-bench-trials" id="toc-test-bench-trials" class="nav-link" data-scroll-target="#test-bench-trials">Test Bench Trials</a></li>
  <li><a href="#hardware-trials" id="toc-hardware-trials" class="nav-link" data-scroll-target="#hardware-trials">Hardware Trials</a></li>
  <li><a href="#results-and-discussion" id="toc-results-and-discussion" class="nav-link" data-scroll-target="#results-and-discussion">Results and Discussion</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul>
<div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://hmc-e155.github.io/assets/doc/E155%20Breadboard%20Adapter%20Schematic.pdf"><i class="bi bi-link-45deg"></i>E155 Breadboard Adapter v4</a></li><li><a href="https://github.com/zoe-worrall/e155_labs/tree/main/fpga/radiant_project/lab07_v5"><i class="bi bi-link-45deg"></i>Lab 7 Github Files for FPGA</a></li><li><a href="https://github.com/zoe-worrall/e155_labs/tree/main/mcu/lab07_mcu"><i class="bi bi-link-45deg"></i>Lab 7 Github Files for MCU</a></li><li><a href="https://www.st.com/resource/en/reference_manual/rm0394-stm32l41xxx42xxx43xxx44xxx45xxx46xxx-advanced-armbased-32bit-mcus-stmicroelectronics.pdf"><i class="bi bi-link-45deg"></i>STM32L432xx Reference Manual</a></li><li><a href="https://www.st.com/resource/en/datasheet/stm32l432kb.pdf"><i class="bi bi-link-45deg"></i>STM32L432xx Datasheet</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 7 Writeup</h1>
  <div class="quarto-categories">
    <div class="quarto-category">labreport</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zoe Worrall - zworrall@g.hmc.edu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="lab-7-aes-128" class="level2">
<h2 class="anchored" data-anchor-id="lab-7-aes-128">Lab 7: AES-128</h2>
<p><em>Hours Spent: 97.5 hours, Mapped with Toggl Track</em></p>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>In this lab, a STM32L432KCU Microcontroller Unit (the MCU) was used to send and receive SPI signals to the Upduino FPGA board. After troubleshooting on the interconnection between the working FPGA board and the MCU board for fifty-three and a half hours, I finally checked my old version of the code with a new FPGA and found that the problem was my FPGA.</p>
<p>This lab requires the user to implement the AES-128 (or the Advanced Encryption Standard) program. The complexity of this lab (should have been) mainly focused on the simulation aspects the encryption standard. As described in the following sections, this encryption standard follows a few definitive steps in order to convert an input string of 128 bits into a newly encoded form - similar to how we communicate with the internet now, with a given key a user can decode and encode a string however they want to prevent unwanted eyes viewing the initial message.</p>
</section>
<section id="aes-128s-structure" class="level3">
<h3 class="anchored" data-anchor-id="aes-128s-structure">AES-128’s Structure</h3>
<p>AES-128 fundamentally encodes a system in such a way that the same key can be used to both encrypt and decrypt a file.</p>
<p>To help myself write the functions necessary for this program, I began by drawing out all of the functions for the program so that I knew what to do within Lattice Radiant. There are, fundamentally 5 functions in this program, one of which uses two small “semi-functions”, I will term them. These are listed below:</p>
<ol type="1">
<li><p>AddRoundKey(state, w_round[3:0]) - Combines the input “state” with a “word” that then converts all of the states inside the “state” listt into a <code>state_prime</code> variable.</p></li>
<li><p>MixColumns(state) – Recombines a set of columns using a predefined matrix of hexadecimal values.</p></li>
<li><p>SubBytes – Uses a function called “sbox” to substitute every word within a matrix with another word. This matrix is unique and causes a high degree of randomness within the completed function.</p></li>
<li><p>ShiftRows – Considering state as a matrix, shifts all the state values over by one two the left (including wrap around) depending on which row the state is.</p></li>
<li><p>KeyExpansion – Defines a new list of words based on a supplied key. For each “round” of the function, new words are created, which are used in other functions to adjust the state.</p></li>
</ol>
<p>Overall, these functions all come together as described in the pseudocode found on page 12 of <a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.197-upd1.pdf">the FIPS manual</a>, and can be seen in the image below <a href="#fig-pseudocode" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div id="fig-pseudocode" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pseudocode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/pseudocode.png" id="fig-pseudocode" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-pseudocode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
<p>I drew out each progran, and will go into further detail with each of the following diagram for my Radiant Software program.</p>
<p><img src="images/blockdiagram.png" class="img-fluid"></p>
<section id="addroundkeystate-w_round" class="level4">
<h4 class="anchored" data-anchor-id="addroundkeystate-w_round">AddRoundKey(state, w_round)</h4>
<p>AddRoundKey is a function that is used to generate the list of words that will be used by the program to alter the incoming key; for each “round” that this cypher goes through, the program will generate a list of words that are dependent upon the initial key supplied to the program.</p>
<p><img src="images/addRoundKey.png" class="img-fluid"></p>
<p>These values are determined with the aid of KeyExpansion <a href="#sec-KeyExpansion" class="quarto-xref">Section&nbsp;1.2.3</a>.</p>
</section>
<section id="mixcolumnsstate" class="level4">
<h4 class="anchored" data-anchor-id="mixcolumnsstate">MixColumns(state)</h4>
<p>MixColumns is a fucntion that uses a XOR gate to combine a mix of rows combined with a pre-assorted list of values specific to the AES fucntion, in this case AES-128. This mixing is one of the special pieces of AES, as it is hard to decipher without the initial list of values (defined in <a href="#fig-definedVals" class="quarto-xref">Figure&nbsp;2</a>)</p>
<div id="fig-definedVals" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-definedVals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/mixColsVals.png" id="fig-definedVals" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-definedVals-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
</figcaption>
</figure>
</div>
<p>For a better perspective on what is happening, I have additionally put together a diagram below that shows the user how this is implemented.</p>
<p><img src="images/mixcolumns.png" class="img-fluid">.</p>
</section>
<section id="sec-KeyExpansion" class="level4">
<h4 class="anchored" data-anchor-id="sec-KeyExpansion">KeyExpansion()</h4>
<p>KeyExpansion uses XOR and a list of ten pre-defined hexadecimal values to change the incoming list of words and alter them for the use of “AddRoundKey”.</p>
<p><img src="images/keyexpansion.png" class="img-fluid"></p>
<p>Depending on the round in which the user finds themselves, KeyExpansion will determine the next word using a mix of rotating the words, substituting the words using the SubWord function ( <a href="#sec-SubWord" class="quarto-xref">Section&nbsp;1.2.3.1</a> ), and XORing values in a specific order.</p>
<section id="sec-SubWord" class="level5">
<h5 class="anchored" data-anchor-id="sec-SubWord">SubWord</h5>
<p>SubBytes is part of the magic of the AES Encryption algorithm, and allows the same value that goes into the matrix, when altered, to be entered again and return its original value. It alters it using something termed “sbox”, where each value is multiplied or combined with some defined list of values. This matrix is extremely large, and as found in the lab, should be implemented using the system’s RAM.</p>
</section>
<section id="rotword" class="level5">
<h5 class="anchored" data-anchor-id="rotword">RotWord</h5>
<p>The RotWord function is implemented within a multitude of functions to rotate a row of the incoming word (termed as “state” within the pseudocode)</p>
</section>
</section>
<section id="shiftrowsstate" class="level4">
<h4 class="anchored" data-anchor-id="shiftrowsstate">ShiftRows(state)</h4>
<p>ShiftRows rotates the incoming word by a differing amount for each row, and as such completely rotates the entire matrix within the function.</p>
<p><img src="images/shiftrows.png" class="img-fluid"></p>
</section>
<section id="subbytes" class="level4">
<h4 class="anchored" data-anchor-id="subbytes">SubBytes()</h4>
<p>SubBytes uses the synchronized version of SubWord ( <a href="#sec-SubWord" class="quarto-xref">Section&nbsp;1.2.3.1</a> ) to perform the sbox transformation <img src="images/subword.png" class="img-fluid"></p>
</section>
</section>
<section id="final-setup" class="level3">
<h3 class="anchored" data-anchor-id="final-setup">Final Setup</h3>
<p>The final design can be represented in the following block diagram. As can be seen in the block diagram, sbox has two potential functions; sbox and sbox_sync. In this case, we need to have a synchronized sbox_sync because there is not enough memory on the FPGA to store the sbox memory before transmitting it. As a result, we need a way to synchronize the sbox in order to prevent its memory from being stored at the same time as other functions so that enough memory is given to the network. This problem with memory mapping can be seen in the image below, where an error message is called due to a Synthesis Error.</p>
<p>As can be seen in the diagram below, despite using synchronized sbox values, all of the RAM on the FPGA is still used by the program and overflows such that most of the registers on the board are used.</p>
</section>
<section id="test-bench-trials" class="level3">
<h3 class="anchored" data-anchor-id="test-bench-trials">Test Bench Trials</h3>
<p>The test bench trials did function properly for both the SPI and the CORE; in order to test both of these, however, a series of smaller test benches needed to be crafted to test each function. These were made using the defined table of AES functions as defined in the PDF.</p>
<p>For each function, a set of vectors for the state input and state output were made, and the program was run to confirm that the right value was received. Since there are no such thing as edge cases in many of these functions, I didn’t construct any fringe case scenarios for this problem.</p>
<p>Testing FSM Testbenches can be seen below, with various zooms on the FSM.</p>
<p><img src="images/testbenches/fsm_testbench.png" class="img-fluid"> <img src="images/testbenches/fsm_tb_2.png" class="img-fluid"> <img src="images/testbenches/fsm_tb_3.png" class="img-fluid"> <img src="images/testbenches/fsm_tb_4.png" class="img-fluid"> <img src="images/testbenches/fsm_tb_round9.png" class="img-fluid"></p>
<p>These FSM’s can be further demonstrated to be working by viewing these in the SPI Tesbenches.</p>
<p><img src="images/testbenches/spi_tb.png" class="img-fluid"> <img src="images/testbenches/spi_tb_2.png" class="img-fluid"> <img src="images/testbenches/spi_tb_3.png" class="img-fluid"></p>
<p>Once all the trials were confirmed to have been working within the testbench, I then moved on to implementing the design onto my actual machine.</p>
</section>
<section id="hardware-trials" class="level3">
<h3 class="anchored" data-anchor-id="hardware-trials">Hardware Trials</h3>
<p>The following schematic shows how the pin connects on the MCU and FPGA builds look.</p>
<p><img src="images/schematic_fpga.png" class="img-fluid"></p>
<p>I faced considerable problems with the hardware set up for this lab; I believe that this was, in part, due to a problem with my PB4 and PB5, which are shorted together due to soldering issues. With my Lab 6, I was able to avoid this issue using PB12 and PA11, but due to some of the requisites of this lab, and the time constraints on my own part, I was unable to complete this aspect of the project.</p>
<p>The majority of the time that was stocked up during this project was the time it took to troubleshoot my software to hardware connection. Compiled, three days worth of hours were spent trying to get the hardware working. Multiple variations of code were tried while troubleshooting:</p>
<ol type="1">
<li><p>Initially, there was no “DONE” block in my FSM, and as a result my final program may have started in the wrong state. I fixed this by rewriting my FSM and making sure I included a state for each potential block.</p></li>
<li><p>I was not initially using the right board, and instead had implemented my program with too few memory blocks; as a result, there were only 12 RAM buckets, and none of the sbox values could fit in them. When I upgraded, this issue was solved.</p></li>
<li><p>I initially had 32 rather than 16 sbox modules initialized; this was because I had initialized an SubBytes register both in my fsm machine, to perform an operation before I entered rounds 1-9, and within my “rounds” function. I solved this by including a system of enables in all my functions, which allowed me to toggle what I was receiving out of “rounds”, and resultantly use rounds for every single computation.</p></li>
</ol>
<p>In the end, however, the issue was not my code; I continued running into the same problem, where the SPI was outputting a variety of values, always the same, but varying with time (there were a total of three distinct SPI values that the FPGA was receiving from the MCU). However, when I programmed my code onto another person’s FPGA, my code worked. I confirmed this on two FPGA boards, and confirmed that the software was correct, but something on my hardware was gone.</p>
</section>
<section id="results-and-discussion" class="level3">
<h3 class="anchored" data-anchor-id="results-and-discussion">Results and Discussion</h3>
<p>I learned a lot of resilience with this project; there were many points where I wanted to give up, but I would continue trying and experimenting. Even though the trial and error felt wasteful, especially close to the end, I believe I understand AES-128 far better than I ever would have if I had gotten it working on my first run through.</p>
<p>As can be seen below, all of the data was able to be seen with the use of a logic analyzer; I have put these in the listings at the bottom of this page.</p>
<p>Additionally, in the future I would like to examine my FPGA with a Logic Analyzer to troubleshoot what’s wrong with the pins, and what may be shorted together on my board.</p>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>In conclusion, after many long hours, I can consider this Lab a success. I think that AES encryption and SPI communications will always be difficult to understand, but with this Lab I’ve gotten proof that I can succeed by working hard.</p>
<div class="quarto-video"><video id="video_shortcode_videojs_video1" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="https://youtube.com/shorts/uR9w-qRpS1g?feature=share"></video></div>
<div class="quarto-video"><video id="video_shortcode_videojs_video2" class="video-js vjs-default-skin vjs-fluid" controls="" preload="auto" data-setup="{}" title=""><source src="https://youtube.com/shorts/uR9w-qRpS1g"></video></div>



</section>
</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">
<div class="quarto-post image-right" data-index="0">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint1.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="1">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint2.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="2">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint3.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="3">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint4.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="4">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint5.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="5">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint6.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="6">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint7.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="7">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint8.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="8">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint9.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="9">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint10.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="10">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint11.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="11">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint12.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="12">
<div class="thumbnail">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
<p><img loading="lazy" src="images/DS1Z_QuickPrint13.png" class="thumbnail-image"></p>
</a><p><a href="" class="no-external"></a></p>
</div>
<div class="body">

</div>
<div class="metadata">
<p><a href="" class="no-external"></a></p><a href="" class="no-external">
</a>
</div>
</div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/zoe-worrall\.github\.io\/e155_labs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zoe-worrall">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/zoeworrall">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>videojs(video_shortcode_videojs_video1);</script>
<script>videojs(video_shortcode_videojs_video2);</script>




<script src="../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>